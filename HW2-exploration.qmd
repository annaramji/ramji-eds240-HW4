---
author: "Anna Ramji"
date: 2024-01-31
title: "Homework 2 Part 2"
---

**(Part 2a) This week, you’ll focus on importing / wrangling / and beginning the exploratory data visualization phase, using the data you found as part of [HW #1, Part II](https://samanthacsik.github.io/EDS-240-data-viz/assignments/HW1.html#part-ii-find-a-data-sets-that-interests-you). Complete the following:**


My Data:

    Agri-food CO2 emission dataset - Forecasting ML (from Kaggle) <https://www.kaggle.com/datasets/alessandrolobello/agri-food-co2-emission-dataset-forecasting-ml>

    Economic Freedom Rankings (filtered date range 1990-2020) from the Frasier Institute's Economic Freedom page <https://www.fraserinstitute.org/economic-freedom/dataset?geozone=world&page=dataset&min-year=1990&max-year=2020&filter=2&most-free=1&quartile2=1&quartile3=1&least-free=1&date-type=range>



**"Agri-food CO2 emissions dataset – Forecasting ML" Variables:**

::: panel-tabset
## Summary

Many variables on emissions relating to the agrifood system, from crop cultivation and residue to food transportation and retail, as well as types of fires and soil-related emissions; year; country; demographic variables about urban, rural, and total population; average temperature (ºC)

## Some variable descriptions

-   Savanna fires: Emissions from fires in savanna ecosystems.
-   Forest fires: Emissions from fires in forested areas.
-   Crop Residues: Emissions from burning or decomposing leftover plant material after crop harvesting.
-   Rice Cultivation: Emissions from methane released during rice cultivation.
-   Drained organic soils (CO2): Emissions from carbon dioxide released when draining organic soils.
-   Pesticides Manufacturing: Emissions from the production of pesticides.
-   Food Transport: Emissions from transporting food products.
-   Forestland: Land covered by forests.
-   Net Forest conversion: Change in forest area due to deforestation and afforestation.
-   Food Household Consumption: Emissions from food consumption at the household level.
-   Food Retail: Emissions from the operation of retail establishments selling food.
-   On-farm Electricity Use: Electricity consumption on farms.
-   Food Packaging: Emissions from the production and disposal of food packaging materials.
-   Agrifood Systems Waste Disposal: Emissions from waste disposal in the agrifood system.
-   Food Processing: Emissions from processing food products.
-   Fertilizers Manufacturing: Emissions from the production of fertilizers.
-   IPPU: Emissions from industrial processes and product use.
-   Manure applied to Soils: Emissions from applying animal manure to agricultural soils.
-   Manure left on Pasture: Emissions from animal manure on pasture or grazing land.
-   Manure Management: Emissions from managing and treating animal manure.
-   Fires in organic soils: Emissions from fires in organic soils.
-   Fires in humid tropical forests: Emissions from fires in humid tropical forests.
-   On-farm energy use: Energy consumption on farms.
-   Rural population: Number of people living in rural areas.
-   Urban population: Number of people living in urban areas.
-   Total Population - Male: Total number of male individuals in the population.
-   Total Population - Female: Total number of female individuals in the population.
-   total_emission: Total greenhouse gas emissions from various sources.
-   Average Temperature °C: The average increasing of temperature (by year) in degrees Celsius.
:::


**Economic Freedom Dataset Variables:** overall rank, country name, year, overall score, size of government, legal systems & property rights, sound money, freedom to trade internationally, and regulation. Of these, I intend to use overall rank, country name, year, and overall score.

There is a lot of metadata linked in the "Methodology" section of the website <https://www.fraserinstitute.org/sites/default/files/uploaded/2022/economic-freedom-of-the-world-2022-appendix.pdf> which gives information on each variable, including how they were determined and methodology.


-   Create an file named, `HW2-exploration.qmd` within your `lastName-eds240-HW4` repo and add appropriate YAML fields

-   Load necessary packages and read in your data

```{r library, warning=FALSE, message=FALSE}
# load necessary packages
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                load packages                             ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

library("tidyverse") # for tidy everything! (data cleaning, wrangling)
library("here") # for reproducible file paths
library("janitor") # used to clean column names
library("naniar") # tools for exploring & handing missing data
library("ggridges") # {ggplot2} extension for creating ridgeline plots
library("ggbeeswarm") # {ggplot2} extension for creating categorical scatter (violin point) plots
library("scales") # provides the internal scaling infrastructure used by ggplot2, and gives you tools to override the default breaks, labels, transformations and palettes (installed automatically with {ggplot2} or {tidyverse})
library("calecopal") # used for custom plot theme
library("ggtext") # used for customizing plot text

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                                import data                               ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

agrifood_emissions <- read_csv(here("data", "Agrofood_co2_emission.csv"))

econ_freedom <- read_csv(here("data", "economic_freedom_quartile_1990_2020.csv"),
                         skip = 4) # the first few columns were not part of my intended dataset (cleaning while reading in)

##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
##                          data cleaning & wrangling                       ----
##~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

# Agri-food CO2 emissions ----

# the column names are not tidy, so I'll start out by renaming them to lower_snake_case()
ag_clean <- agrifood_emissions |> 
  janitor::clean_names() |> 
# the column names are quite long, though informative, so I'll first select the columns/variables I'm most interested in...
  select(area, year, total_emission, average_temperature_c, urban_population, rural_population, rice_cultivation, crop_residues, pesticides_manufacturing, food_transport, agrifood_systems_waste_disposal, forestland, food_household_consumption, food_retail, food_packaging, savanna_fires, forest_fires, net_forest_conversion, drained_organic_soils_co2) |> 

# and then rename them to more easily referable titles 
  rename(country = area, 
         avg_temp_c = average_temperature_c,
         urban_pop = urban_population,
         rural_pop = rural_population,
         pesticide_manuf = pesticides_manufacturing,
         agfood_waste_disposal = agrifood_systems_waste_disposal,
         f_hh_consumption = food_household_consumption,
         net_forest_conv = net_forest_conversion,
         food_pack = food_packaging
         )  
  
  # because I'm interested in plotting countries and years, I'll coerce the country data types to factor and year to a date
 # mutate(country = as.factor(country),
  #       year = as.factor(year))




# Economic Freedom ----

# the economic freedom dataset has an extra empty column at the beginning, so I'll start by dropping that column and renaming the columns to lower_snake_case()
econ_clean <- econ_freedom |> 
  select(-...1) |> 
  janitor::clean_names() |> 

# there are lots of interesting columns in this dataset, but for now I'm only interested in a few for my data visualizations. I'll select and reorder them here:
  select(year, iso_code, countries, economic_freedom_summary_index, rank, quartile, tariffs)  |> 
  
  # next, I'll coerce the datatypes of year and countries to be factors, while updating the name of countries to country to match our agrifood emissions dataset and drop the old column
#  mutate(year = as.factor(year),
 #        country = as.factor(countries)) |> 
  rename(country = countries)

# data exploration ----

# the country columns differ at many points... I'll need to clean these up before I can join the dataframes
# 
#unique(econ_clean$country)

#setdiff(ag_clean$country, econ_clean$country)
#setdiff(econ_clean$country, ag_clean$country)

# maybe I should just drop the economic freedom dataset...

# Creating ag-food subset (grouped) ----

ag_top_emitters <- ag_clean |> 
  group_by(year, country) |> 
  arrange(desc(total_emission)) |> 
  filter(country %in% c("China", "Indonesia", "Brazil", "United States of America", "India"))
  

usa_food <- ag_clean |> 
  filter(country %in% c("United States of America"))


emissions_2020 <- ag_clean |> 
  filter(year %in% c("2020"))

```


-   Create at least **three** (but of course feel free to create more!) exploratory visualizations (similar to plot #1 and #2 in Part I of this assignment).

```{r exploratory-viz}

# plot 0.1: total CO2 emissions per country

# (incredibly messy)
# ggplot(data = ag_clean,
#        aes(x = country,
#            y = total_emission)) +
#   geom_point() +
#   coord_flip()

# plot 0.2: 

ggplot(data = usa_food,
       aes(x = year,
           y = total_emission)) +
  geom_point() +
  geom_line() +
  theme_bw()

ggplot(data = ag_top_emitters,
       aes(x = year,
           y = total_emission)) +
#  geom_point(aes(color = country)) +
  geom_line(aes(color = country)) +
  theme_bw()
```


-   **IMPORTANT:** If you have a downloaded data file saved to your repo (e.g. you’re not reading in your data directly from online, from a server, etc.) be sure to add your data folder / file to your `.gitignore`, particularly if this file is large.

**(Part 2b) After completing the above steps, answer the following questions:**

-   **1.** What have you learned about your data? Have any potentially interesting patterns emerged? **(5-8 sentences)**

-   **2.** In HW #1, you outlined some questions that you wanted to answer using these data. Have you made any strides towards answering those questions? If yes, how so? If no, what next steps do you need to take (e.g. I need to create X plot type, I still need to track down Y data, I need to restructure existing data so that you can visualize it in Z ways, etc.)? **(8-12 sentences)**

-   **3.** What challenges do you foresee encountering with your data? These can be data wrangling and / or visualization challenges. **(4-6 sentences)**
